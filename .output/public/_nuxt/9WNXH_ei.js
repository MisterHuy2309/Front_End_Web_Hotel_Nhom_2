import{r as d,g as C,N as w,c as t,p as A,a as s,F as m,j as p,t as v,q as b,v as x,O as K,P as H,o,n as _}from"./BYeJzb1c.js";import{_ as L}from"./DlAUqK2U.js";import{H as N,L as M}from"./Dd-WNJ37.js";const T={class:"chat-container"},B={key:0,class:"sidebar"},S=["onClick"],D=["src"],R={key:1,class:"no-customer"},U={key:2,class:"chat-box"},V={class:"messages"},F={class:"chat-input"},I="https://via.placeholder.com/50",j={__name:"AdminChat",setup(q){const r=d([]),l=d(null),h=d([]),c=d(""),i=new N().withUrl("http://nhom2webkhachsan.runasp.net/chathub").configureLogging(M.Information).build(),k=async()=>{try{const e=await H.get("http://nhom2webkhachsan.runasp.net/api/KhachHang");r.value=e.data,console.log("Danh sách khách hàng:",r.value)}catch(e){console.error("Lỗi khi lấy danh sách khách hàng:",e)}},y=async()=>{i.on("ReceiveMessage",(e,n)=>{console.log("Tin nhắn nhận được từ:",e,"Nội dung:",n),l.value&&e===l.value.maKhachHang&&h.value.push({text:n,isAdmin:!1})}),i.on("AdminNotAvailable",e=>{console.error(e)}),i.on("CustomerNotAvailable",e=>{console.error(e)});try{await i.start(),console.log("SignalR connected.")}catch(e){console.error("SignalR connection error:",e)}},f=e=>{console.log("Khách hàng được chọn:",e),l.value=e,h.value=[]},g=async()=>{if(console.log("Tin nhắn gửi đi:",c.value),!c.value.trim())return;const e=c.value.trim();h.value.push({text:e,isAdmin:!0});try{await i.invoke("SendMessageToCustomer",l.value.maKhachHang,e),c.value=""}catch(n){console.error("Lỗi khi gửi tin nhắn:",n)}};return C(async()=>{await k(),await y()}),w(()=>{i.stop()}),(e,n)=>(o(),t("div",T,[r.value.length>0?(o(),t("div",B,[n[1]||(n[1]=s("h2",null,"Danh sách khách hàng",-1)),s("ul",null,[(o(!0),t(m,null,p(r.value,a=>{var u;return o(),t("li",{key:a.maKhachHang,onClick:z=>f(a),class:_({active:((u=l.value)==null?void 0:u.maKhachHang)===a.maKhachHang})},[s("img",{src:a.hinhAnh||I,alt:"Avatar",class:"avatar"},null,8,D),s("span",null,v(a.hoTen),1)],10,S)}),128))])])):(o(),t("div",R,n[2]||(n[2]=[s("p",null,"Không có khách hàng nào để hiển thị.",-1)]))),l.value?(o(),t("div",U,[s("h2",null,"Chat với "+v(l.value.hoTen),1),s("div",V,[(o(!0),t(m,null,p(h.value,(a,u)=>(o(),t("div",{key:u,class:_(a.isAdmin?"admin-message":"customer-message")},v(a.text),3))),128))]),s("div",F,[b(s("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=a=>c.value=a),placeholder:"Nhập tin nhắn...",onKeyup:K(g,["enter"])},null,544),[[x,c.value]]),s("button",{onClick:g},"Gửi")])])):A("",!0)]))}},P=L(j,[["__scopeId","data-v-2ca7ad1c"]]);export{P as default};
