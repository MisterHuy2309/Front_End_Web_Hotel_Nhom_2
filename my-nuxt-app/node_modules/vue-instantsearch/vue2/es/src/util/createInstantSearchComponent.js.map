{"version":3,"file":"createInstantSearchComponent.js","sources":["../../../../src/util/createInstantSearchComponent.js"],"sourcesContent":["import { INSTANTSEARCH_FUTURE_DEFAULTS } from 'instantsearch.js/es/lib/InstantSearch';\n\nimport { version } from '../../package.json'; // rollup does pick only what needed from json\nimport { createSuitMixin } from '../mixins/suit';\n\nimport { _objectSpread } from './polyfills';\nimport { isVue3, version as vueVersion } from './vue-compat';\nimport { warn } from './warn';\n\nexport const createInstantSearchComponent = (component) =>\n  _objectSpread(\n    {\n      mixins: [createSuitMixin({ name: 'InstantSearch' })],\n      provide() {\n        return {\n          $_ais_instantSearchInstance: this.instantSearchInstance,\n        };\n      },\n      watch: {\n        searchClient(searchClient) {\n          warn(\n            false,\n            'The `search-client` prop of `<ais-instant-search>` changed between renders, which may cause more search requests than necessary. If this is an unwanted behavior, please provide a stable reference: https://www.algolia.com/doc/api-reference/widgets/instantsearch/vue/#widget-param-search-client'\n          );\n\n          this.instantSearchInstance.helper.setClient(searchClient).search();\n        },\n        indexName(indexName) {\n          this.instantSearchInstance.helper.setIndex(indexName || '').search();\n        },\n        compositionID(compositionID) {\n          this.instantSearchInstance.helper\n            .setIndex(compositionID || '')\n            .search();\n        },\n        stalledSearchDelay(stalledSearchDelay) {\n          // private InstantSearch.js API:\n          this.instantSearchInstance._stalledSearchDelay = stalledSearchDelay;\n        },\n        routing() {\n          throw new Error(\n            'routing configuration can not be changed dynamically at this point.' +\n              '\\n\\n' +\n              'Please open a new issue: https://github.com/algolia/instantsearch/discussions/new?category=ideas&labels=triage%2cLibrary%3A+Vue+InstantSearch&title=Feature%20request%3A%20dynamic%20props'\n          );\n        },\n        onStateChange() {\n          throw new Error(\n            'onStateChange configuration can not be changed dynamically at this point.' +\n              '\\n\\n' +\n              'Please open a new issue: https://github.com/algolia/instantsearch/discussions/new?category=ideas&labels=triage%2cLibrary%3A+Vue+InstantSearch&title=Feature%20request%3A%20dynamic%20props'\n          );\n        },\n        searchFunction(searchFunction) {\n          // private InstantSearch.js API:\n          this.instantSearchInstance._searchFunction = searchFunction;\n        },\n        middlewares: {\n          immediate: true,\n          handler(next, prev) {\n            (prev || [])\n              .filter((middleware) => (next || []).indexOf(middleware) === -1)\n              .forEach((middlewareToRemove) => {\n                this.instantSearchInstance.unuse(middlewareToRemove);\n              });\n\n            (next || [])\n              .filter((middleware) => (prev || []).indexOf(middleware) === -1)\n              .forEach((middlewareToAdd) => {\n                this.instantSearchInstance.use(middlewareToAdd);\n              });\n          },\n        },\n        future(future) {\n          this.instantSearchInstance.future = Object.assign(\n            INSTANTSEARCH_FUTURE_DEFAULTS,\n            future\n          );\n        },\n      },\n      created() {\n        const searchClient = this.instantSearchInstance.client;\n        if (typeof searchClient.addAlgoliaAgent === 'function') {\n          searchClient.addAlgoliaAgent(`Vue (${vueVersion})`);\n          searchClient.addAlgoliaAgent(`Vue InstantSearch (${version})`);\n        }\n      },\n      mounted() {\n        // from the documentation: https://vuejs.org/v2/api/#mounted\n        // \"Note that mounted does not guarantee that all child components have also been mounted. If you want to\n        // wait until the entire view has been rendered, you can use vm.$nextTick inside of mounted\"\n        this.$nextTick(() => {\n          if (!this.instantSearchInstance.started) {\n            this.instantSearchInstance.start();\n          }\n        });\n      },\n      [isVue3 ? 'beforeUnmount' : 'beforeDestroy']() {\n        if (this.instantSearchInstance.started) {\n          this.instantSearchInstance.dispose();\n        }\n\n        // a hydrated instance will no longer be hydrated once disposed, and starts from scratch\n        this.instantSearchInstance.__initialSearchResults = undefined;\n      },\n    },\n    component\n  );\n"],"names":["createInstantSearchComponent","component","_objectSpread","mixins","createSuitMixin","name","provide","$_ais_instantSearchInstance","this","instantSearchInstance","watch","searchClient","warn","helper","setClient","search","indexName","setIndex","compositionID","stalledSearchDelay","_stalledSearchDelay","routing","Error","onStateChange","searchFunction","_searchFunction","middlewares","immediate","handler","next","prev","filter","middleware","indexOf","forEach","middlewareToRemove","unuse","middlewareToAdd","use","future","Object","assign","INSTANTSEARCH_FUTURE_DEFAULTS","created","const","client","addAlgoliaAgent","vueVersion","version","mounted","$nextTick","started","start","dispose","__initialSearchResults","undefined"],"mappings":"sUASaA,WAAgCC,gBAC3CC,MACE,CACEC,OAAQ,CAACC,EAAgB,CAAEC,KAAM,mBACjCC,mBACE,MAAO,CACLC,4BAA6BC,KAAKC,wBAGtCC,MAAO,CACLC,sBAAaA,GACXC,GACE,GAIFJ,KAAKC,sBAAsBI,OAAOC,UAAUH,GAAcI,UAE5DC,mBAAUA,GACRR,KAAKC,sBAAsBI,OAAOI,SAASD,GAAa,IAAID,UAE9DG,uBAAcA,GACZV,KAAKC,sBAAsBI,OACxBI,SAASC,GAAiB,IAC1BH,UAELI,4BAAmBA,GAEjBX,KAAKC,sBAAsBW,oBAAsBD,GAEnDE,mBACE,MAAM,IAAIC,MACR,sQAKJC,yBACE,MAAM,IAAID,MACR,4QAKJE,wBAAeA,GAEbhB,KAAKC,sBAAsBgB,gBAAkBD,GAE/CE,YAAa,CACXC,WAAW,EACXC,iBAAQC,EAAMC,eACXA,GAAQ,IACNC,gBAAQC,UAAqD,KAArCH,GAAQ,IAAII,QAAQD,KAC5CE,iBAASC,GACR3B,EAAKC,sBAAsB2B,MAAMD,MAGpCN,GAAQ,IACNE,gBAAQC,UAAqD,KAArCF,GAAQ,IAAIG,QAAQD,KAC5CE,iBAASG,GACR7B,EAAKC,sBAAsB6B,IAAID,OAIvCE,gBAAOA,GACL/B,KAAKC,sBAAsB8B,OAASC,OAAOC,OACzCC,EACAH,KAINI,mBACEC,IAAMjC,EAAeH,KAAKC,sBAAsBoC,OACJ,mBAAjClC,EAAamC,kBACtBnC,EAAamC,wBAAwBC,OACrCpC,EAAamC,sCAAsCE,SAGvDC,8BAIEzC,KAAK0C,qBACE1C,EAAKC,sBAAsB0C,SAC9B3C,EAAKC,sBAAsB2C,aAIU,yBACrC5C,KAAKC,sBAAsB0C,SAC7B3C,KAAKC,sBAAsB4C,UAI7B7C,KAAKC,sBAAsB6C,4BAAyBC,MAGxDtD"}